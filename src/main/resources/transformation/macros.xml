<?xml version="1.0" encoding="UTF-8"?>
<macros xmlns="http://www.culturegraph.org/metamorph">

  <macro name="regex-del-punctuation-end">
    <data source="$[dsource]" name="$[dname]">
      <replace pattern="^[Â©]|\s?[,.:;/=]?$" with="" />
    </data>
  </macro>

  <macro name="personName">
    <data name="$[name]" source="$[field]1 .a">
      <replace pattern="(?&lt;!\p{Upper})\.$|[,]$" with="" />
    </data>
  </macro>

  <macro name="personTitle">
    <entity name="$[name][]" flushWith="$[field]1 " sameEntity="true">
      <data name="" source="$[field]1 .c">
        <replace pattern="[,]$" with="" />
      </data>
    </entity>
  </macro>

  <macro name="personBio">
    <data name="$[name]" source="$[field]1 .d">
      <replace pattern="[.]$" with="" />
    </data>
  </macro>

  <macro name="personRole">
    <entity name="$[name][]" flushWith="$[field]1 " sameEntity="true">
      <data name="" source="$[field]1 .e" />
      <compose prefix="[" postfix="]" />
    </entity>
  </macro>

  <macro name="prepare-SeriesAddedEntryUniformTitle-title">
    <concat delimiter=" ; " name="@title$[basefield]" flushWith="$[field]">
      <data source="$[field].a" >
        <replace pattern="\s?;?$" with="" />
        <compose prefix="!next!" /> <!-- workaround for a "flush before" -->
      </data>
      <data source="$[field].v" >
        <replace pattern="\s?\.?$" with="" />
      </data>
    </concat>
  </macro>

  <macro name="SeriesAddedEntryUniformTitle-title">
    <entity name="title[]" flushWith="$[field]" sameEntity="true">
      <data name="" source="@title$[basefield]">
        <replace pattern="^!next!" with="" />
        <split delimiter=" ; !next!" />
      </data>
    </entity>
  </macro>
</macros>
