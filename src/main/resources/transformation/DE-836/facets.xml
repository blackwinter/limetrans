<?xml version="1.0" encoding="UTF-8"?>
<rules xmlns="http://www.culturegraph.org/metamorph">
  <data source="leader" name="@LeaderPos06">
    <substring start="06" end="07" />
  </data>
  <data source="leader" name="@LeaderPos07">
    <substring start="07" end="08" />
  </data>
  <data source="006" name="@006Pos00">
    <substring start="00" end="01" />
  </data>
  <data source="006" name="@006Pos06">
    <substring start="06" end="07" />
  </data>
  <data source="006" name="@006Pos09">
    <substring start="09" end="10" />
  </data>
  <data source="006" name="@006Pos12">
    <substring start="12" end="13" />
  </data>
  <data source="006" name="@006Pos16">
    <substring start="16" end="17" />
  </data>
  <data source="006" name="@006Pos17">
    <substring start="17" end="18" />
  </data>
  <data source="007" name="@007Pos00">
    <substring start="00" end="01" />
  </data>
  <data source="007" name="@007Pos01">
    <substring start="01" end="02" />
  </data>
  <data source="008" name="@008Pos23">
    <substring start="23" end="24" />
  </data>
  <data source="008" name="@008Pos26">
    <substring start="26" end="27" />
  </data>
  <data source="008" name="@008Pos29">
    <substring start="29" end="30" />
  </data>
  <data source="008" name="@008Pos33">
    <substring start="33" end="34" />
  </data>
  <data source="008" name="@008Pos34">
    <substring start="34" end="35" />
  </data>

  <data source="@LeaderPos06" name="@type">
    <lookup in="typeLeader06" />
  </data>
  <combine name="@type" value="B">
    <if>
      <all>
        <data source="@LeaderPos06">
          <equals string="a" />
        </data>
        <data source="@LeaderPos07">
          <regexp match="[acdm]" />
        </data>
      </all>
    </if>
    <data source="001" />
  </combine>
  <combine name="@type" value="CR">
    <if>
      <all>
        <data source="@LeaderPos06">
          <equals string="a" />
        </data>
        <data source="@LeaderPos07">
          <regexp match="[bi]" />
        </data>
      </all>
    </if>
    <data source="001" />
  </combine>

  <!-- @facet_format -->
  <combine name="@facet_format" value="Audio">
    <if>
      <any>
        <data source="@LeaderPos06">
          <regexp match="[ij]" />
        </data>
        <data source="@006Pos00">
          <regexp match="[ijk]" />
        </data>
        <all>
          <data source="@type">
            <equals string="CF" />
          </data>
          <data source="@008Pos26">
            <equals string="h" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <equals string="m" />
          </data>
          <data source="@006Pos09">
            <equals string="h" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Bild">
    <if>
      <any>
        <all>
          <data source="@007Pos00">
            <equals string="k" />
          </data>
          <data source="@007Pos01">
            <regexp match="[cdefhijklnpqrsuvz]" />
          </data>
        </all>
        <data source="@007Pos00">
          <equals string="r" />
        </data>
        <all>
          <data source="@type">
            <equals string="M" />
          </data>
          <data source="@008Pos3[34]">
            <regexp match="[jo]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[ef]" />
          </data>
          <data source="@006Pos1[67]">
            <regexp match="[jo]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <equals string="VM" />
          </data>
          <data source="@008Pos33">
            <regexp match="[dikln]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[gkor]" />
          </data>
          <data source="@006Pos16">
            <regexp match="[dikln]" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Elektronische Ressource">
    <if>
      <any>
        <data source="@LeaderPos06">
          <equals string="m" />
        </data>
        <data source="@006Pos00">
          <equals string="m" />
        </data>
        <data source="@007Pos00">
          <equals string="c" />
        </data>
        <all>
          <data source="@type">
            <regexp match="^(B|Mu|CR|MX)$" />
          </data>
          <data source="@008Pos23">
            <regexp match="[sq]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[acdijpst]" />
          </data>
          <data source="@006Pos06">
            <regexp match="[qs]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[efgkor]" />
          </data>
          <data source="@006Pos12">
            <regexp match="[qs]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <regexp match="[sq]" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Film, Dia, Video">
    <if>
      <any>
        <data source="@007Pos00">
          <regexp match="[gmv]" />
        </data>
        <all>
          <data source="@type">
            <equals string="VM" />
          </data>
          <data source="@008Pos33">
            <regexp match="[fvtsm]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[gkor]" />
          </data>
          <data source="@006Pos16">
            <regexp match="[fvtsm]" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Gedruckte Ressource">
    <if>
      <any>
        <data source="@LeaderPos06|@006Pos00">
          <regexp match="[op]" />
        </data>
        <all>
          <data source="@007Pos00">
            <equals string="k" />
          </data>
          <data source="@007Pos01">
            <regexp match="[fjs]" />
          </data>
        </all>
        <data source="@007Pos00">
          <equals string="o" />
        </data>
        <all>
          <data source="@007Pos00">
            <equals string="t" />
          </data>
          <data source="@007Pos01">
            <regexp match="[ab]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(B|Mu|CR|MX)$" />
          </data>
          <data source="@008Pos23">
            <regexp match="[dr]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[acdijpst]" />
          </data>
          <data source="@006Pos06">
            <regexp match="[dr]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <regexp match="[dr]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <regexp match="[dr]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[efgkor]" />
          </data>
          <data source="@006Pos12">
            <regexp match="[dr]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <equals string="VM" />
          </data>
          <data source="@008Pos33">
            <equals string="b" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[gkor]" />
          </data>
          <data source="@006Pos16">
            <equals string="b" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Landkarte">
    <if>
      <any>
        <data source="@LeaderPos06">
          <regexp match="[ef]" />
        </data>
        <data source="@006Pos00">
          <regexp match="[ef]" />
        </data>
        <data source="@007Pos00">
          <regexp match="[ad]" />
        </data>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Mikroform">
    <if>
      <any>
        <data source="@007Pos00">
          <equals string="h" />
        </data>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <regexp match="[abc]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[efgkor]" />
          </data>
          <data source="@006Pos12">
            <regexp match="[abc]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[acdijpst]" />
          </data>
          <data source="@006Pos06">
            <regexp match="[abc]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(B|Mu|CR|MX)$" />
          </data>
          <data source="@008Pos23">
            <regexp match="[abc]" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Online-Ressource">
    <if>
      <any>
        <all>
          <data source="@type">
            <regexp match="^(B|Mu|CF|CR|MX)$" />
          </data>
          <data source="@008Pos23">
            <equals string="o" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <equals string="o" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[acdijpstm]" />
          </data>
          <data source="@006Pos06">
            <equals string="o" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[efgkor]" />
          </data>
          <data source="@006Pos12">
            <equals string="o" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <combine name="@facet_format" value="Sonstiges">
    <if>
      <any>
        <data source="@LeaderPos06|@006Pos00">
          <equals string="r" />
        </data>
        <data source="@007Pos00">
          <equals string="f" />
        </data>
        <all>
          <data source="@007Pos00">
            <equals string="k" />
          </data>
          <data source="@007Pos01">
            <regexp match="[ago]" />
          </data>
        </all>
        <all>
          <data source="@007Pos00">
            <regexp match="[fz]" />
          </data>
          <data source="@007Pos01">
            <regexp match="[cuz]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[acdijpst]" />
          </data>
          <data source="@006Pos06">
            <regexp match="[f#]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(B|CR|Mu|MX)$" />
          </data>
          <data source="@008Pos23">
            <regexp match="[f#]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <regexp match="^(M|VM)$" />
          </data>
          <data source="@008Pos29">
            <regexp match="[f#]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[efgkor]" />
          </data>
          <data source="@006Pos12">
            <regexp match="[f#]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <equals string="m" />
          </data>
          <data source="@006Pos09">
            <regexp match="[acdfgijmuz]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <equals string="CF" />
          </data>
          <data source="@008Pos26">
            <regexp match="[acdfgijmuz]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <equals string="M" />
          </data>
          <data source="@008Pos3[43]">
            <regexp match="[#lnprz]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[ef]" />
          </data>
          <data source="@006Pos1[67]">
            <regexp match="[#lnprz]" />
          </data>
        </all>
        <all>
          <data source="@type">
            <equals string="VM" />
          </data>
          <data source="@008Pos33">
            <regexp match="[acgpoqrwz]" />
          </data>
        </all>
        <all>
          <data source="@006Pos00">
            <regexp match="[gkor]" />
          </data>
          <data source="@006Pos16">
            <regexp match="[acgpoqrwz]" />
          </data>
        </all>
      </any>
    </if>
    <data source="001" />
  </combine>
  <!-- END format -->
  <data name="@facet_date" source="260  .c|2603 .c">
    <replace pattern=" ?[-,.:;/\]]?$|,.*$|^[©c\[] *" with="" />
  </data>

  <entity name="dc" flushWith="record">
    <entity name="format[]" flushWith="record">
      <data name="" source="@facet_format" />
    </entity>
    <entity name="format[]">
      <if>
        <none>
          <data source="@facet_format" />
        </none>
      </if>
      <data name="" source="001">
        <constant value="keine Angabe" />
      </data>
    </entity>
    <data name="language" source="@language" />
    <combine name="language" value="keine Angabe">
      <if>
        <none>
          <data source="@language" />
        </none>
      </if>
      <data source="001" />
    </combine>
    <entity name="date[]" flushWith="record">
      <data name="" source="@facet_date" />
    </entity>
    <entity name="date[]" >
      <if>
        <none>
          <data source="@facet_date" />
        </none>
      </if>
      <data name="" source="001">
        <constant value="keine Angabe" />
      </data>
    </entity>	
  </entity>
</rules>
